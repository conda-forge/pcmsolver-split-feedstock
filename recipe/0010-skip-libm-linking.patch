From 2d992203f146b2333daa19e8823860cdc626856a Mon Sep 17 00:00:00 2001
From: "Lori A. Burns" <lori.burns@gmail.com>
Date: Sat, 5 Apr 2025 14:44:19 -0400
Subject: [PATCH] skip libm linking

---
 CMakeLists.txt               | 3 +++
 cmake/custom/pcmsolver.cmake | 4 +++-
 tests/C_host/CMakeLists.txt  | 4 ++++
 3 files changed, 10 insertions(+), 1 deletion(-)

diff --git a/CMakeLists.txt b/CMakeLists.txt
index 4df71327..57dadb85 100644
--- a/CMakeLists.txt
+++ b/CMakeLists.txt
@@ -4,6 +4,9 @@
 # set minimum cmake version
 cmake_minimum_required(VERSION 3.16 FATAL_ERROR)
 cmake_policy(SET CMP0053 NEW)
+if(POLICY CMP0177)
+    cmake_policy(SET CMP0177 NEW)
+endif()
 
 # project name
 project(PCMSolver LANGUAGES CXX C Fortran)
diff --git a/cmake/custom/pcmsolver.cmake b/cmake/custom/pcmsolver.cmake
index da5f4906..c4c7678b 100644
--- a/cmake/custom/pcmsolver.cmake
+++ b/cmake/custom/pcmsolver.cmake
@@ -27,7 +27,9 @@ if(NOT DEFINED PYMOD_INSTALL_LIBDIR)
   set(PYMOD_INSTALL_LIBDIR "/python" CACHE STRING "Location within CMAKE_INSTALL_LIBDIR to which Python modules are installed" FORCE)
 else()
   message(STATUS "Setting option PYMOD_INSTALL_LIBDIR (should start with /): ${PYMOD_INSTALL_LIBDIR}")
-  set(PYMOD_INSTALL_LIBDIR "${PYMOD_INSTALL_LIBDIR}" CACHE STRING "Location within CMAKE_INSTALL_LIBDIR to which Python modules are installed" FORCE)
+  file(TO_CMAKE_PATH "${PYMOD_INSTALL_LIBDIR}" pymod_tmp)
+  message(STATUS "Setting option PYMOD_INSTALL_LIBDIR (processed):           ${pymod_tmp}")
+  set(PYMOD_INSTALL_LIBDIR "${pymod_tmp}" CACHE STRING "Location within CMAKE_INSTALL_LIBDIR to which Python modules are installed" FORCE)
 endif()
 file(TO_NATIVE_PATH "${CMAKE_INSTALL_LIBDIR}${PYMOD_INSTALL_LIBDIR}/pcmsolver" PYMOD_INSTALL_FULLDIR)
 
diff --git a/tests/C_host/CMakeLists.txt b/tests/C_host/CMakeLists.txt
index d51758e6..560832c7 100644
--- a/tests/C_host/CMakeLists.txt
+++ b/tests/C_host/CMakeLists.txt
@@ -4,7 +4,9 @@ target_include_directories(C_host
     ${PROJECT_SOURCE_DIR}/tests/C_host
   )
 target_link_libraries(C_host PCMSolver)
+if (NOT WIN32)
 target_link_libraries(C_host m)
+endif()
 set_target_properties(C_host
   PROPERTIES
     LINKER_LANGUAGE C
@@ -28,7 +30,9 @@ target_include_directories(fail-C_host
     ${PROJECT_SOURCE_DIR}/tests/C_host
   )
 target_link_libraries(fail-C_host PCMSolver)
+if (NOT WIN32)
 target_link_libraries(fail-C_host m)
+endif()
 set_target_properties(fail-C_host
   PROPERTIES
     LINKER_LANGUAGE C
-- 
2.40.1

